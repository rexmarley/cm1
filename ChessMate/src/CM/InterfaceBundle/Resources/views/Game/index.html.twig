{% extends '::base.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
	{% stylesheets '../vendor/components/jqueryui/themes/smoothness/jquery-ui.min.css' filter='cssrewrite'  %} 
        <link href="{{ asset_url }}" rel="stylesheet" type="text/css" />
	{% endstylesheets %}
{% endblock %}
        
{% block body %}
	<div class="row">
	    <div class="errors col-md-6">
		</div>
	</div>
	{% if game is defined %}
		{% set gameID = game.id %}
		{% set offset = "" %}
	{% else %}
		{% set gameID = null %}
		{% if games is not empty %}
			<div class="row">
			    <div class="col-md-6 col-md-offset-3">
	    			<a id="showCurrentGames" class="btn btn-large btn-danger">You have current games!</a>
				</div>
			</div>
		{% endif %}
		{% set offset = "col-md-offset-3" %}
		<div class="row">
		    <div class="col-md-6 col-md-offset-3">
    			<a id="startGame" class="btn btn-large btn-success">Start Game</a>
			</div>
		</div>
		{{ include('CMInterfaceBundle:Game:newGameOptions.html.twig', {}) }}
	{% endif %}
	<div class="row">
	    <div class="col-md-6 {{ offset }}">
		    {{ render(controller('CMInterfaceBundle:Game:showBoard', { 'gameID': gameID })) }}
		</div>
		<div class="col-md-6 col-sm-12">
			{% if gameID %}
				{# if game is defined else render start game options #}
				<div id="midGame">
					{{ include('CMInterfaceBundle:Game:piecesWonOrLost.html.twig', { 'wonLost': 'Lost'}) }}
					{{ include('CMInterfaceBundle:Game:chatBox.html.twig', {}) }}
					{{ include('CMInterfaceBundle:Game:midGameOptions.html.twig', {}) }}
					<br>
					{{ include('CMInterfaceBundle:Game:piecesWonOrLost.html.twig', { 'wonLost': 'Won'}) }}
				</div>			
			{% endif %}
		</div>
	</div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {% javascripts '%kernel.root_dir%/../vendor/jquery/jquery/jquery.min.js' %}
        <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}
    {% javascripts '%kernel.root_dir%/../vendor/components/jqueryui/ui/minified/jquery-ui.min.js' %}
        <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}
	{% if game is defined %}
	    <script>
	    	$(document).ready(function(){
		    	//set game state
		    	activePlayer = {{game.activePlayerIndex }};
		    	abstractBoard = {{ game.board.board |json_encode|raw }};
		    	unmoved = {{ game.board.unmoved |json_encode|raw}};
		    	//TODO: castled?, En passant etc.
	    	});
	    </script>
	{% endif %}
    <script type="text/javascript" src="{{ asset('bundles/cminterface/js/board.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/cminterface/js/boardHelper.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/cminterface/js/general.js') }}"></script>
{% endblock %}
